<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: profile-view.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: profile-view.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {Component} from 'react';
import Button from "react-bootstrap/Button";
import Container from "react-bootstrap/Container";
import axios from 'axios';
import Card from 'react-bootstrap/Card';
import {Link} from "react-router-dom";

import "./profile-view.scss";

export class ProfileView extends Component {
  constructor(props){
    super(props);

    this.state = {
      favoriteMovies: [],
      username: null,
      email: null,
      birthdate: null
    }
  }

  componentDidMount = () => {
    let accessToken = localStorage.getItem('token');
    if (accessToken !== null) {
      this.getUser(accessToken);
    }
  }

   /**
     * gets user info for display.
     * @param {number} token 
     * @return {object} user info
     */
  getUser = (token) => {
    let username = localStorage.getItem('user');
    const userURL = "https://shielded-anchorage-97078.herokuapp.com/users/";
    axios.get(userURL + username, {
      headers: { Authorization: `Bearer ${token}` }
    })
      .then(response => {

        this.setState({
          username: response.data.Username,
          email: response.data.Email,
          birthdate: response.data.BirthDate.substr(0,10),
          favoriteMovies: response.data.FavoriteMovies
        });
      })
      .catch(function (error) {
        console.log(error);
      });
  }
  
  /**
   * deletes user from database
   * @param {event} deleteAccount
   * @return {alert} removed account
   */
  deleteProfile = (e) => {
    e.preventDefault();
    const user = localStorage.getItem("user");
    const userURL = "https://shielded-anchorage-97078.herokuapp.com/users/" + user;

    axios.delete(userURL)
      .then(response => {
        const data = response.data;
        window.open("/client", "_self");
        console.log(data);
        localStorage.clear();
      })
      .catch((e) => {
        console.log("error registering the user");
      });
  }

   /**
       * removes favorite movie from localStorage
       * @param {EventTarget} movieId
       * @param {number} movieId
       * @return {alert} removed id from favorite list
       */

  deleteMovie = (e, movieId) => {
    e.preventDefault();
    const url = `https://shielded-anchorage-97078.herokuapp.com/users/`;
    const user = localStorage.getItem("user");
    const deleteMovie = `${url}${user}/Movies/${movieId}`;
    axios.delete(deleteMovie, {
      headers: { Authorization: `Bearer ${localStorage.getItem('token')}` }
    })
      .then(response => {
        console.log(response);

        this.getUser(localStorage.getItem("token"));
      })
      .catch(event => {
        console.log(event);
      });

    let favorites  = JSON.parse(localStorage.getItem("favorites"));

    favorites.splice(favorites.indexOf(movieId), 1)
    localStorage.setItem("favorites", JSON.stringify(favorites));
  }

  render(){
    const {favoriteMovies, username, email, birthdate} = this.state;
    let movies = JSON.parse(localStorage.getItem("movies"));

    let filteredFavorites = [];
    movies.map(m => {
      favoriteMovies.forEach(favorite => {
        if (m._id === favorite) {
          filteredFavorites.push(m);
        }
      })
    });

    return (
      &lt;Container className="profile-view">
        &lt;Card className="profile-card">
          &lt;h2 className="profile-title">Profile Info&lt;/h2>
          &lt;h4>Username&lt;/h4>
          &lt;p>{username}&lt;/p>
          &lt;h4>Email&lt;/h4>
          &lt;p>{email}&lt;/p>
          &lt;h4>Birth Date&lt;/h4>
          &lt;p>{birthdate}&lt;/p>
          &lt;h4>Favorite Movies&lt;/h4>
          &lt;ul>
            {
              filteredFavorites.map(favorite => {
                return (
                  &lt;li key={favorite._id} className="movie-item">{favorite.title} | 
                  &lt;span className="delete-movie" onClick={(e) => this.deleteMovie(e, favorite._id)}> Delete&lt;/span>
                  &lt;/li>
                )
                })
              }
          &lt;/ul>
          &lt;div className="buttons-container">
            &lt;Link to={"/"}>
              &lt;Button className="back-button">Back&lt;/Button>
            &lt;/Link>
            &lt;Button 
              className="delete-button"
              onClick={this.deleteProfile}>
                Delete Profile
            &lt;/Button>
            &lt;Link to={"/update"}>
              &lt;Button
                className="update-button">
                Update Profile
              &lt;/Button>
            &lt;/Link>
          &lt;/div>
        &lt;/Card>
      &lt;/Container>
    );
  }

}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sat Feb 08 2020 16:21:20 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
